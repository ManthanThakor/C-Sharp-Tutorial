@{
    ViewData["Title"] = "Chat Section";
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>

<div class="chat-container chat-room">
    <div class="chat-box">
        <div class="chat-header">
            <h2><i class="fas fa-comment-dots"></i> Live Chat</h2>
        </div>
        <ul id="messagesList" class="messages"></ul>
        <div class="chat-input">
            <input type="text" id="messageInput" placeholder="Type your message..." />
            <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chatHub")
        .build();

    connection.start().catch(err => console.error("Connection failed: " + err.toString()));

    connection.on("ReceiveMessage", (user, message) => {
        const li = document.createElement("li");
        li.classList.add("chat-bubble");
        li.innerHTML = `<strong>${user}:</strong> <span>${message}</span>`;

        document.getElementById("messagesList").appendChild(li);
        li.classList.add("fade-in");
        document.getElementById("messagesList").scrollTop = document.getElementById("messagesList").scrollHeight;
    });

    function sendMessage() {
        const messageInput = document.getElementById("messageInput");
        const message = messageInput.value.trim();

        if (message === "") {
            messageInput.classList.add("shake");
            setTimeout(() => messageInput.classList.remove("shake"), 300);
            return;
        }

        connection.invoke("SendMessage", message).catch(err => console.error(err.toString()));
        messageInput.value = "";
    }
</script>
<link href="~/css/stylesheet.css" rel="stylesheet" />

